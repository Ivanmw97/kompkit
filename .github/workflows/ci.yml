name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build-react-lib:
    name: Build React Library
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/react
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
      - run: npm ci
      - run: npm run build --if-present

  build-vue-lib:
    name: Build Vue Library
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/vue
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
      - run: npm ci
      - run: npm run build --if-present

  build-android-lib:
    name: Build Android Library
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: packages/android
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: 17
      - name: Grant Gradle permission
        run: chmod +x ../../gradlew
      - name: Build with Gradle
        run: ../../gradlew assembleRelease

  build-react-playground:
    name: Build React Playground
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'

      - name: Install React Lib Dependencies
        run: npm ci
        working-directory: packages/react

      - name: Build React Library
        run: npm run build
        working-directory: packages/react

      - name: Install Playground Dependencies
        run: npm ci
        working-directory: playground/react-example

      - name: Build Playground
        run: npm run build
        working-directory: playground/react-example

  build-vue-playground:
    name: Build Vue Playground
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'

      - name: Install Vue Lib Dependencies
        run: npm ci
        working-directory: packages/vue

      - name: Build Vue Library
        run: npm run build
        working-directory: packages/vue

      - name: Install Playground Dependencies
        run: npm ci
        working-directory: playground/vue-example

      - name: Build Playground
        run: npm run build
        working-directory: playground/vue-example

  build-android-playground:
    name: Build Android Playground
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: playground/android-example
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: 17
      - name: Grant Gradle permission
        run: chmod +x ../../gradlew
      - name: Build with Gradle
        run: ../../gradlew assembleDebug
